<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Doorstep Banking - Master Configuration</title>
    <link rel="stylesheet" href="styles.css?v=3" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">Doorstep Banking</div>
      <div class="topbar-actions">
        <span class="user-badge" data-user-badge></span>
        <button class="secondary-btn" data-logout>Logout</button>
      </div>
    </header>

    <main class="page page-wide">
      <section class="recon-card">
        <h1>Master Configuration</h1>
        <p class="subtitle">Configure masters with maker-checker approval.</p>

        <div class="card-grid">
          <button class="secondary-btn" data-section="bank-stores">Bank Store Master</button>
          <a class="nav-card" data-page="vendor-onboarding" href="vendor-onboarding.html">
            Vendor Master
          </a>
          <button class="secondary-btn" data-section="charge-configs">Charge Configuration</button>
          <button class="secondary-btn" data-section="pickup-rules">Pickup Rules (Beat/Call)</button>
          <button class="secondary-btn" data-section="vendor-charges">Vendor Charge Master</button>
          <button class="secondary-btn" data-section="customer-charge-slabs">Customer Charge Slabs</button>
          <button class="secondary-btn" data-section="waivers">Waiver Master</button>
          <button class="secondary-btn" data-section="vendor-file-formats">Vendor File Format Config</button>
        </div>

        <div class="master-section" id="bank-stores">
          <h2>Bank Store Master</h2>
          <form id="bank-store-form" class="card-form">
            <input type="text" name="bankStoreCode" placeholder="Bank store code" required />
            <input type="text" name="storeName" placeholder="Store name" />
            <input type="text" name="solId" placeholder="SOL ID" />
            <input type="number" step="0.01" name="dailyPickupLimit" placeholder="Daily pickup limit" />
            <input type="date" name="effectiveFrom" required />
            <select name="status" required>
              <option value="ACTIVE">ACTIVE</option>
              <option value="INACTIVE">INACTIVE</option>
            </select>
            <button class="primary-btn" type="submit">Submit Request</button>
            <p class="form-message" id="bank-store-message"></p>
          </form>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Code</th>
                  <th>Name</th>
                  <th>Status</th>
                  <th>Effective From</th>
                </tr>
              </thead>
              <tbody id="bank-store-rows"></tbody>
            </table>
          </div>
        </div>

        <div class="master-section" id="charge-configs">
          <h2>Charge Configuration</h2>
          <p class="subtitle">
            Required config codes: ENHANCEMENT_THRESHOLD_AMOUNT, ENHANCEMENT_CHARGE_AMOUNT,
            GST_ENABLED (value_text Y/N), GST_RATE_PERCENT, CUSTOMER_CHARGE_RATE_PERCENT.
          </p>
          <form id="charge-config-form" class="card-form">
            <input type="text" name="configCode" placeholder="Config code" required />
            <input type="text" name="configName" placeholder="Config name" required />
            <input type="number" step="0.0001" name="valueNumber" placeholder="Value number" />
            <input type="text" name="valueText" placeholder="Value text" />
            <input type="date" name="effectiveFrom" required />
            <select name="status" required>
              <option value="ACTIVE">ACTIVE</option>
              <option value="INACTIVE">INACTIVE</option>
            </select>
            <button class="primary-btn" type="submit">Submit Request</button>
            <p class="form-message" id="charge-config-message"></p>
          </form>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Code</th>
                  <th>Name</th>
                  <th>Value</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="charge-config-rows"></tbody>
            </table>
          </div>
        </div>

        <div class="master-section" id="pickup-rules">
          <h2>Pickup Rules</h2>
          <form id="pickup-rule-form" class="card-form">
            <select name="pickupType" required>
              <option value="BEAT">BEAT</option>
              <option value="CALL">CALL</option>
            </select>
            <input type="number" name="freeLimit" placeholder="Free limit (CALL)" />
            <input type="date" name="effectiveFrom" required />
            <select name="status" required>
              <option value="ACTIVE">ACTIVE</option>
              <option value="INACTIVE">INACTIVE</option>
            </select>
            <button class="primary-btn" type="submit">Submit Request</button>
            <p class="form-message" id="pickup-rule-message"></p>
          </form>
        </div>

        <div class="master-section" id="vendor-charges">
          <h2>Vendor Charge Master</h2>
          <form id="vendor-charge-form" class="card-form">
            <input type="number" name="vendorId" placeholder="Vendor ID" required />
            <select name="pickupType" required>
              <option value="BEAT">BEAT</option>
              <option value="CALL">CALL</option>
            </select>
            <input type="number" step="0.01" name="baseCharge" placeholder="Base charge" required />
            <input type="date" name="effectiveFrom" required />
            <select name="status" required>
              <option value="ACTIVE">ACTIVE</option>
              <option value="INACTIVE">INACTIVE</option>
            </select>
            <button class="primary-btn" type="submit">Submit Request</button>
            <p class="form-message" id="vendor-charge-message"></p>
          </form>
        </div>

        <div class="master-section" id="customer-charge-slabs">
          <h2>Customer Charge Slabs</h2>
          <p class="subtitle">
            Vendor-specific slab-based charges for customers. Amount ranges (amount_from to amount_to) and fixed charge per slab.
            Example: Upto 50K = 4000, 50K-1L = 4500, etc. Beat pickup enhancement (₹60/₹50k) is applied separately.
          </p>
          <form id="customer-slab-form" class="card-form">
            <label class="field">
              <span class="label">Vendor</span>
              <select id="slab-vendor" name="vendorId" required>
                <option value="">Select vendor</option>
              </select>
            </label>
            <input type="number" step="0.01" name="amountFrom" placeholder="Amount from (e.g. 0)" required />
            <input type="number" step="0.01" name="amountTo" placeholder="Amount to (e.g. 50000)" required />
            <input type="number" step="0.01" name="chargeAmount" placeholder="Charge amount (₹)" required />
            <input type="text" name="slabLabel" placeholder="Slab label (e.g. Upto 50K)" />
            <input type="date" name="effectiveFrom" required />
            <button class="primary-btn" type="submit">Add Slab</button>
            <p class="form-message" id="customer-slab-message"></p>
          </form>
          <div class="table-wrapper">
            <label class="field">
              <span class="label">Filter by Vendor</span>
              <select id="slab-filter-vendor">
                <option value="">All vendors</option>
              </select>
            </label>
            <table>
              <thead>
                <tr>
                  <th>Vendor</th>
                  <th>Amount From</th>
                  <th>Amount To</th>
                  <th>Charge (₹)</th>
                  <th>Label</th>
                  <th>Effective From</th>
                </tr>
              </thead>
              <tbody id="customer-slab-rows"></tbody>
            </table>
          </div>
        </div>

        <div class="master-section" id="waivers">
          <h2>Waiver Master</h2>
          <form id="waiver-form" class="card-form">
            <input type="text" name="customerId" placeholder="Customer ID" required />
            <select name="waiverType" required>
              <option value="PERCENT">PERCENT</option>
              <option value="CAP">CAP</option>
              <option value="BOTH">BOTH</option>
            </select>
            <input type="number" step="0.01" name="waiverPercentage" placeholder="Waiver %" />
            <input type="number" step="0.01" name="waiverCapAmount" placeholder="Waiver cap amount" />
            <input type="date" name="waiverFrom" required />
            <input type="date" name="waiverTo" />
            <button class="primary-btn" type="submit">Submit Request</button>
            <p class="form-message" id="waiver-message"></p>
          </form>
        </div>

        <div class="master-section" id="vendor-file-formats">
          <h2>Vendor File Format Config</h2>
          <p class="subtitle">
            Header mapping JSON must include pickup_date_column, pickup_amount_column,
            vendor_store_code_column. Optional: pickup_type_column, account_no_column,
            customer_id_column, customer_name_column, remittance_amount_column, remittance_date_column.
          </p>
          <form id="vendor-format-form" class="card-form">
            <label class="field">
              <span class="label">Vendor</span>
              <select id="vendor-format-vendor" name="vendorId" required>
                <option value="">Select vendor</option>
              </select>
            </label>
            <input type="text" name="formatName" placeholder="Format name" required />
            <textarea
              name="headerMapping"
              rows="6"
              placeholder='{"pickup_date_column":"PickUpDate","pickup_amount_column":"Total","vendor_store_code_column":"HCM_COUSTOMERCODE","account_no_column":"AccountCode","customer_id_column":"HCM_COUSTOMERCODE","customer_name_column":"CustomerName","remittance_amount_column":"Total"}'
              required
            ></textarea>
            <input type="date" name="effectiveFrom" required />
            <button class="primary-btn" type="submit">Submit Request</button>
            <p class="form-message" id="vendor-format-message"></p>
          </form>
          <div class="table-wrapper">
            <h3>Visual Mapping</h3>
            <p class="subtitle">Type the vendor column names for each field, then generate JSON.</p>
            <label class="field">
              <span class="label">Sample Vendor File (to load headers)</span>
              <input type="file" id="vendor-format-sample" accept=".xlsx,.xls" />
            </label>
            <table>
              <thead>
                <tr>
                  <th>Canonical Field</th>
                  <th>Vendor Column Header</th>
                </tr>
              </thead>
              <tbody id="vendor-format-mapping-rows"></tbody>
            </table>
            <div class="button-row">
              <button class="secondary-btn" type="button" id="generate-vendor-mapping">
                Generate JSON
              </button>
            </div>
          </div>
          <div class="subtitle">
            Sample mapping (Vendor MIS Sample 1):
            <pre class="code-block">
{"pickup_date_column":"PickUpDate","pickup_amount_column":"Total","vendor_store_code_column":"HCM_COUSTOMERCODE","account_no_column":"AccountCode","customer_id_column":"HCM_COUSTOMERCODE","customer_name_column":"CustomerName","remittance_amount_column":"Total"}
            </pre>
            Sample mapping (Vendor MIS Sample 2):
            <pre class="code-block">
{"pickup_date_column":"pickup Date","pickup_amount_column":"Pickup Amount","vendor_store_code_column":"Pickup Point Code","account_no_column":"Account Number","customer_id_column":"CLIENT CODE","customer_name_column":"CUSTOMER NAME","pickup_type_column":"Beat/oncall","remittance_amount_column":"Deposit Amount","remittance_date_column":"Deposition date"}
            </pre>
          </div>
          <div class="table-wrapper">
            <h3>Existing Formats</h3>
            <p class="subtitle">Select a vendor to view approved formats.</p>
            <label class="field">
              <span class="label">Filter by Vendor</span>
              <select id="vendor-format-filter">
                <option value="">Select vendor</option>
              </select>
            </label>
            <table>
              <thead>
                <tr>
                  <th>Format ID</th>
                  <th>Vendor</th>
                  <th>Format Name</th>
                  <th>Status</th>
                  <th>Effective From</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="vendor-format-rows"></tbody>
            </table>
            <p class="form-message" id="vendor-format-list-message"></p>
          </div>
          <div class="table-wrapper">
            <h3>Request Status</h3>
            <p class="subtitle">Track request status for a vendor.</p>
            <label class="field">
              <span class="label">Vendor</span>
              <select id="vendor-format-request-filter">
                <option value="">Select vendor</option>
              </select>
            </label>
            <table>
              <thead>
                <tr>
                  <th>Request ID</th>
                  <th>Format ID</th>
                  <th>Format Name</th>
                  <th>Status</th>
                  <th>Created Date</th>
                  <th>Checker Comment</th>
                </tr>
              </thead>
              <tbody id="vendor-format-request-rows"></tbody>
            </table>
            <p class="form-message" id="vendor-format-request-message"></p>
          </div>
        </div>
      </section>
    </main>

    <script src="config.js?v=1"></script>
    <script src="app.js?v=2"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="masters.js?v=12"></script>
  </body>
</html>
